source_up

p() {
  id="$1"
  export LC_DOING="$1"
  leetcode show "$1" --gen --extra -l golang
}

export_function p

# gen test
gt() {
  if [[ "$OSTYPE" == "darwin"* ]]; then
    alias xgrep="grep -E"
  else
    alias xgrep="grep -P"
  fi
  # find the new generated go file
  TARGET=$(git ls-files --others --exclude-standard | grep -v "_test.go" | xgrep '\d+\..*\.go')
  echo $TARGET
  FUNC_NAME=$(cat $TARGET | egrep -wo 'func \w*' | sed 's/func //')
  echo $FUNC_NAME
  gotests -only $FUNC_NAME -i -template_dir ./templates -w .
}
export_function gt

# next
n() {
  NEXT_PROBLEM=$(leetcode ls -q eD | tail -n 7 | head -n 1 | awk '{print $3}' | tr -d ']')
  p $NEXT_PROBLEM
  FILE=$(ls $NEXT_PROBLEM.*.go)
  printf '%s\n%s\n' "package main" "$(cat $FILE)" >$FILE
  gofmt -e -s -w $NEXT_PROBLEM.*.go
}

export_function n
